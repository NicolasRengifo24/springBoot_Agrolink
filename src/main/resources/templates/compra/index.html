<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pasarela de Pago — Agrolink</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

<style>

    body {
        font-family: "Inter", sans-serif;
        background: linear-gradient(145deg, #e8f3df, #f5faf1);
        padding: 40px 0;
    }

    .payment-container {
        max-width: 1100px;
        margin: auto;
        display: flex;
        gap: 40px;
        align-items: flex-start;
    }

    /* ─────────────── CARD PRINCIPAL ─────────────── */
    .payment-card {
        background: rgba(255,255,255,0.85);
        backdrop-filter: blur(18px);
        border-radius: 22px;
        padding: 35px;
        box-shadow: 0 15px 45px rgba(0,0,0,0.12);
        flex: 1;
        animation: fadeUp .7s ease;
    }

    @keyframes fadeUp {
        from { opacity:0; transform:translateY(25px); }
        to   { opacity:1; transform:translateY(0); }
    }

    /* ─────────────── MÉTODOS DE PAGO ─────────────── */
    .payment-option {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 14px 20px;
        border: 2px solid #d9e6d8;
        border-radius: 14px;
        cursor: pointer;
        transition: .3s;
        background: #f8fbf6;
    }

    .payment-option:hover {
        border-color: #2f6b31;
        background: #f3f8ef;
    }

    .payment-option.active {
        border-color: #2f6b31;
        background: #e9f5e5;
    }

    /* ─────────────── RESUMEN ─────────────── */
    .summary-box {
        width: 350px;
        background: white;
        border-radius: 20px;
        padding: 25px;
        box-shadow: 0 12px 30px rgba(0,0,0,0.15);
    }

    .summary-box h4 {
        font-weight: 700;
        color: #2f6b31;
    }

    .divider {
        height: 1px;
        background: #d6dfd3;
        margin: 15px 0;
    }

    /* ─────────────── BOTÓN ─────────────── */
    .pay-btn {
        background: #2f6b31;
        color: white;
        border-radius: 14px;
        padding: 14px;
        font-size: 1.2rem;
        width: 100%;
        transition: .3s;
        box-shadow: 0 8px 18px rgba(47,107,49,.3);
    }
    .pay-btn:hover {
        background: #255927;
        transform: translateY(-2px);
    }

</style>

</head>
<body>

<div class="payment-container">

    <!-- FORMULARIO PRINCIPAL -->
    <div class="payment-card">

        <h2 class="fw-bold mb-4 text-success">Confirmar Pago</h2>

        <!-- CORREO -->
        <div class="mb-4">
            <label class="fw-semibold">Correo del cliente</label>
            <input type="email" id="emailField" class="form-control p-3" placeholder="cliente@email.com">
        </div>

        <!-- MÉTODOS DE PAGO -->
        <label class="fw-semibold mb-2">Método de pago</label>

        <div class="d-grid gap-3">

            <div class="payment-option" onclick="selectMethod('Nequi', this)">
                <i class="bi bi-phone-vibrate fs-3 text-success"></i> Nequi
            </div>

            <div class="payment-option" onclick="selectMethod('Daviplata', this)">
                <i class="bi bi-wallet2 fs-3 text-danger"></i> Daviplata
            </div>

            <div class="payment-option" onclick="selectMethod('PSE', this)">
                <i class="bi bi-bank fs-3 text-primary"></i> PSE
            </div>

            <div class="payment-option" onclick="selectMethod('Tarjeta de Crédito', this)">
                <i class="bi bi-credit-card fs-3 text-warning"></i> Tarjeta de Crédito
            </div>

        </div>

        <!-- BOTÓN PAGAR -->
        <button class="pay-btn mt-4" onclick="processPayment()">
            Pagar ahora <i class="bi bi-check2-circle ms-2"></i>
        </button>

    </div>

    <!-- RESUMEN DEL PEDIDO -->
    <div class="summary-box">
        <h4 class="">Resumen</h4>

        <div id="summaryItems" class="mt-3"></div>

        <div class="divider"></div>

        <p class="d-flex justify-content-between">
            <span>Envío:</span>
            <strong>$7.000</strong>
        </p>

        <p class="d-flex justify-content-between fs-5 fw-bold text-success">
            <span>Total:</span>
            <span id="summaryTotal"></span>
        </p>
    </div>

</div>

<script>
let selectedMethod = "";

// Selección visual del método
function selectMethod(method, element) {
    document.querySelectorAll(".payment-option").forEach(e => e.classList.remove("active"));
    element.classList.add("active");
    selectedMethod = method;
}

// Renderizar resumen usando carrito
function loadSummary() {
    const cart = JSON.parse(localStorage.getItem("cart")) || [];
    let box = document.getElementById("summaryItems");
    let total = 0;

    cart.forEach(p => {
        const sub = p.price * p.qty;
        total += sub;

        box.innerHTML += `
            <p class="d-flex justify-content-between">
                <span>${p.name} × ${p.qty}</span>
                <strong>${sub.toLocaleString("es-CO",{style:"currency",currency:"COP"})}</strong>
            </p>
        `;
    });

    document.getElementById("summaryTotal").innerText =
        (total + 7000).toLocaleString("es-CO",{style:"currency","currency":"COP"});
}

loadSummary();

// PROCESAR PAGO
async function processPayment() {

    const email = document.getElementById("emailField").value;

    if (!email.trim()) {
        alert("Debes ingresar un correo.");
        return;
    }

    if (!selectedMethod) {
        alert("Selecciona un método de pago.");
        return;
    }

    const exitoDePagoHTML = localStorage.getItem("exitoDePago.HTML");

    await fetch("http://localhost:8080/api/email/invoice", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({
            email: email,
            invoiceNumber: "202500874",
            html: exitoDePago.HTML
        })
    });

    window.location.href = "success.html";
}

</script>

</body>
</html>
