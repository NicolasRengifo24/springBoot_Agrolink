<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Producto | Agrolink</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

    <!-- AOS -->
    <link href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" rel="stylesheet">

    <style>
        body { background: #f6f8f4; font-family: "Inter", sans-serif; }
        .product-gallery { background: #fff; border-radius: 18px; padding: 20px; box-shadow: 0 5px 20px rgba(0,0,0,0.06);}
        .product-gallery img { border-radius: 12px; width: 100%; object-fit: cover; }
        .thumbs img { cursor: pointer; opacity: 0.7; transition: .2s; }
        .thumbs img:hover { opacity: 1; }
        .product-info { background: #fff; padding: 25px; border-radius: 18px; box-shadow: 0 5px 20px rgba(0,0,0,0.06); }
        .product-title { font-size: 2rem; font-weight: 700; }
        .product-price { font-size: 2rem; color: #2f6b31; font-weight: 700; }
        .btn-buy { background: #2f6b31; color: white; padding: 14px 22px; border-radius: 12px; width: 100%; }
        .btn-buy:hover { background: #1d4820; color: #fff; }
        .details-box { background: #fff; padding: 25px; border-radius: 18px; box-shadow: 0 5px 20px rgba(0,0,0,0.06); }
        .product-card { border-radius: 16px; overflow: hidden; background: white; transition: .2s; box-shadow: 0 5px 12px rgba(0,0,0,0.05); }
        .product-card:hover{ transform: translateY(-4px); }
        .product-img{ height: 200px; width: 100%; object-fit: cover; }
    </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top shadow-sm">
    <div class="container">
        <a class="navbar-brand fw-bold text-success" th:href="@{/}">
            <i class="bi bi-shop fs-3 me-1"></i> Agrolink
        </a>
    </div>
</nav>

<div class="container" style="margin-top:120px;">
    <div class="breadcrumb-custom">
        <a th:href="@{/}">Inicio</a> /
        <a href="#" th:text="${producto.nombreProducto}">Nombre producto</a>
    </div>

    <div class="row g-4 mt-4">
        <div class="col-md-6" data-aos="fade-right">
            <div class="product-gallery">
                <img id="main-img" th:src="${#lists.isEmpty(producto.imagenesProducto) ? '/imag/placeholder.jpg' : '/' + producto.imagenesProducto[0].urlImagen}" alt="Imagen principal">
                <div class="row mt-3 thumbs g-2">
                    <div class="col-3" th:each="img : ${producto.imagenesProducto}">
                        <img th:src="${'/' + img.urlImagen}" class="img-fluid rounded" onclick="changeImg(this)" />
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-6" data-aos="fade-left">
            <div class="product-info">
                <h2 class="product-title" th:text="${producto.nombreProducto}">Nombre producto</h2>

                <div class="d-flex align-items-center mt-2">
                    <i class="bi bi-star-fill text-warning"></i>
                    <i class="bi bi-star-fill text-warning"></i>
                    <i class="bi bi-star-fill text-warning"></i>
                    <i class="bi bi-star-fill text-warning"></i>
                    <i class="bi bi-star text-warning"></i>
                    <span class="ms-2 text-muted">(120 opiniones)</span>
                </div>

                <p class="product-price mt-3" th:text="${'$' + #numbers.formatDecimal(producto.precio, 1, 'POINT', 2, 'POINT')}">$0.00</p>

                <p class="text-muted" th:text="${producto.descripcionProducto}">Descripción</p>

                <h6 class="mt-4">Selecciona cantidad</h6>
                <form th:action="@{/cliente/carrito/agregar}" method="post">
                    <input type="hidden" name="idProducto" th:value="${producto.idProducto}" />
                    <div class="d-flex align-items-center gap-3">
                        <input type="number" name="cantidad" class="form-control w-25" min="1" th:max="${producto.stock}" value="1" />
                        <div>
                            <button class="btn-buy" type="submit">
                                <i class="bi bi-cart-plus me-2"></i> Agregar al carrito
                            </button>
                        </div>
                    </div>
                </form>

                <form th:action="@{/compras/crear}" method="get" class="mt-2">
                    <input type="hidden" name="idProducto" th:value="${producto.idProducto}" />
                    <button class="btn btn-outline-success w-100 mt-2" type="submit">
                        <i class="bi bi-bag-check me-2"></i> Comprar ahora
                    </button>
                </form>
            </div>
        </div>
    </div>

    <div class="details-box mt-5" data-aos="fade-up">
        <h4 class="fw-bold">Descripción del producto</h4>
        <p class="mt-2" th:text="${producto.descripcionProducto}"></p>

        <h5 class="fw-bold mt-4">Características</h5>
        <ul>
            <li th:if="${producto.categoria != null}">✔ <span th:text="${producto.categoria.nombreCategoria}"></span></li>
            <li>✔ Sin conservantes ni químicos</li>
            <li>✔ Directo del productor al consumidor</li>
        </ul>

        <h5 class="fw-bold mt-4">Información del productor</h5>
        <p th:text="${producto.productor != null ? (producto.productor.usuario.nombre + ' — ' + producto.productor.usuario.ciudad) : 'Productor no disponible'}">Finca "La Esperanza" — Huila</p>
    </div>

    <h3 class="fw-bold mt-5 mb-3" data-aos="fade-up">Productos relacionados</h3>
    <div class="row g-4">
        <div class="col-md-3" th:each="rel : ${relacionados}" data-aos="zoom-in">
            <div class="product-card">
                <img th:src="${#lists.isEmpty(rel.imagenesProducto) ? '/imag/placeholder.jpg' : '/' + rel.imagenesProducto[0].urlImagen}" class="product-img">
                <div class="p-3">
                    <h5 th:text="${rel.nombreProducto}">Nombre</h5>
                    <p class="text-muted" th:text="${rel.descripcionProducto}">Descripción</p>
                    <a th:href="@{'/cliente/producto/' + ${rel.idProducto}}" class="btn btn-success w-100">Ver producto</a>
                </div>
            </div>
        </div>
    </div>

</div>

<footer class="footer bg-success text-white text-center py-3 mt-5">
    © 2025 Agrolink – Todos los derechos reservados.
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
<script>
    AOS.init({ duration: 800, once: true });
    function changeImg(el){ document.getElementById("main-img").src = el.src; }
</script>
</body>
</html>
